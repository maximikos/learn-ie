
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" sizes="100x100" href="../../../_static/logo/iep_favicon.ico" type="image/x-icon">
    <title>Import and Export &#8212; IEP  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=0e43bd88" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../../_static/documentation_options.js?v=8a448e45"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/design-tabs.js?v=36754332"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/theory/methods/io';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/brightway-lca/brightway-documentation/main/source/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'latest';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="LCA" href="lca.html" />
    <link rel="prev" title="Methods" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/nemora_logo_small.png" class="logo__image only-light" alt="IEP  documentation - Home"/>
    <script>document.write(`<img src="../../../_static/nemora_logo_small.png" class="logo__image only-dark" alt="IEP  documentation - Home"/>`);</script>
  
  
</a></div>
    
      <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Theory
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../insights/index.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../resources/index.html">
                        FAQ
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../contributing/index.html">
                        Contributing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../contact/contact.html">
                        Contact
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../about/index.html">
                        About
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/maximikos" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Theory
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../insights/index.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../resources/index.html">
                        FAQ
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links-2">
                    More
                </button>
                <ul id="pst-nav-more-links-2" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../contributing/index.html">
                        Contributing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../contact/contact.html">
                        Contact
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../about/index.html">
                        About
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/maximikos" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../history/index.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Concepts</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Methods</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Import and Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="lca.html">LCA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../structure.html">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uncertainty.html">Uncertainty</a></li>
<li class="toctree-l1"><a class="reference internal" href="../graph_traversal.html">Graph traversal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../static_and_stochastic_lca.html">Normal Static LCA</a></li>

</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Theory</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Methods</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Import and Export</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="admonition attention">
<p class="admonition-title">Attention</p>
<p><strong>HELP WANTED</strong> <br />
You can help update and improve the content on this page. <br />
Please start by reading the <a class="reference internal" href="#../contributing/contributing.md"><span class="xref myst">guide to contributing to the Brightway documentation.</span></a></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>NEEDS WORK</strong> <br />
This page is not yet complete. <br />
It has been transfered over from the legacy documentation.</p>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="import-and-export">
<h1>Import and Export<a class="headerlink" href="#import-and-export" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>There are some standards for life cycle inventory data, but the sad
truth is that there are no really good standards, and each
implementation of the standards has its own quirks. The basic strategy
for importing data from other programs is the following:</p>
<ul class="simple">
<li><p>First, data is extracted from the export format (ecospold 1,
ecospold 2, SimaPro CSV) into the same format as the activity and
exchanges discussed above. Extraction is done using a
format-specific extractor. Currently, there are extractors for
<code class="docutils literal notranslate"><span class="pre">ecospold1</span></code>, <code class="docutils literal notranslate"><span class="pre">ecospold1-lcia</span></code>,
<code class="docutils literal notranslate"><span class="pre">ecospold2</span></code>, <code class="docutils literal notranslate"><span class="pre">excel</span></code>,
<code class="docutils literal notranslate"><span class="pre">exiobase</span></code>, <code class="docutils literal notranslate"><span class="pre">simapro</span> <span class="pre">CSV</span></code>, and <code class="docutils literal notranslate"><span class="pre">simapro</span> <span class="pre">CSV-lcia</span></code>.</p></li>
<li><p>Next, each dataset is normalized or transformed to make it better
conform to what Brightway2 expects. This could mean, for example,
copying the only production exchange to the list of
<code class="docutils literal notranslate"><span class="pre">products</span></code>, or normalizing the units or biosphere
category names. This step could also include applying migrations,
which are additional dataset that can be used to transform data to
new forms. For example, SimaPro changes ecoinvent activity and
product names, and the <code class="docutils literal notranslate"><span class="pre">simapro-ecoinvent-3</span></code> changes
these names back to what ecoinvent provided. Migrations are
explained in more detail below.</p></li>
<li><p>The third step is to link exchanges to activities within the
imported data. Brightway2 has a powerful generic linking function
called <code class="docutils literal notranslate"><span class="pre">link_iterable_by_fields</span></code> that does the heavy
lifting. This function will link an exchange if the fields match,
i.e. it has the same name, location, unit, etc.
<code class="docutils literal notranslate"><span class="pre">link_iterable_by_fields</span></code> can also be told to only link
certain types of exchanges, such as biosphere exchanges.</p></li>
<li><p>Many imported datasets will link to other databases already
installed on your computer. You can link these exchanges using the
<code class="docutils literal notranslate"><span class="pre">.match_database()</span></code> function. You can customize this
function by specifying the fields to use, as well as other options.</p></li>
<li><p>You should then check on the quality of linking using the
<code class="docutils literal notranslate"><span class="pre">statistics()</span></code> function, which will tell you how many
exchanges are in the data, and how many unlinked exchanges are
present, as well as the types of unlinked exchanges.</p></li>
<li><p>You are finally ready to choose what to do with the imported data.
If all exchanges are linked, you can write a new database with
<code class="docutils literal notranslate"><span class="pre">.write_database()</span></code>. You can also save your work with
<code class="docutils literal notranslate"><span class="pre">.write_unlinked(name)</span></code>, which will save a new unlinked
database for further processing at a later time. You can also write
details on linking with <code class="docutils literal notranslate"><span class="pre">.write_excel()</span></code>, which can
write the entire data or just the unlinked exchanges. Of course, you
can always continue with steps 2, 3, and 4, refining your linking
until you are satisfied.</p></li>
</ul>
<p>If this seems a bit overwhelming, that’s because it is - and a huge
pain. The current data formats and lack of well-defined strategies for
interchange between databases and even updating databases makes life
much more difficult than it should be. There are concrete examples of
importing databases in <code class="docutils literal notranslate"><span class="pre">example-io-notebooks</span></code>.</p>
<section id="importing-from-ecospold-1">
<h3>Importing from <code class="docutils literal notranslate"><span class="pre">ecospold</span> <span class="pre">1</span></code><a class="headerlink" href="#importing-from-ecospold-1" title="Link to this heading">#</a></h3>
<p>Importing from ecospold 1 is relatively simple. Multioutput products are
allocated to single output products using the given allocation factors
using the strategy <code class="docutils literal notranslate"><span class="pre">es1_allocate_multioutput</span></code>. The reference product is
then assigned using the strategy <code class="docutils literal notranslate"><span class="pre">assign_only_product_as_production</span></code>.</p>
<p>Next, some basic data cleanup is performed. Integer codes are removed,
as these are not used consistently by different LCA software
(<code class="docutils literal notranslate"><span class="pre">clean_integer_codes</span></code>). Unspecified subcategories are removed (i.e.
<code class="docutils literal notranslate"><span class="pre">('air',</span> <span class="pre">'unspecified')</span></code> is changed to <code class="docutils literal notranslate"><span class="pre">('air',)</span></code>) using
<code class="docutils literal notranslate"><span class="pre">drop_unspecified_subcategories</span></code>. Biosphere exchange names and
categories are normalized using <code class="docutils literal notranslate"><span class="pre">normalize_biosphere_categories</span></code> and
<code class="docutils literal notranslate"><span class="pre">normalize_biosphere_names</span></code>. Biosphere exchanges are removed, as
biosphere flows do not have locations (<code class="docutils literal notranslate"><span class="pre">strip_biosphere_exc_locations</span></code>).</p>
<p>Next, a unique activity code is generated for each dataset, using a
combination of the name, categories, location, and unit
(<code class="docutils literal notranslate"><span class="pre">set_code_by_activity_hash</span></code>).</p>
<p>Finally, biosphere flows are linked to the default biosphere database,
and internal technosphere flows are linked using
<code class="docutils literal notranslate"><span class="pre">link_technosphere_by_activity_hash</span></code>.</p>
</section>
</section>
<section id="import">
<h2>Import<a class="headerlink" href="#import" title="Link to this heading">#</a></h2>
<section id="importing-from-ecospold-2">
<h3>Importing from <code class="docutils literal notranslate"><span class="pre">ecospold</span> <span class="pre">2</span></code><a class="headerlink" href="#importing-from-ecospold-2" title="Link to this heading">#</a></h3>
<p>Importing from ecospold 2 is a bit complex, because although ecospold 2
gives unique IDs for many fields, which helps in linking, the current
implementation has some <code class="docutils literal notranslate"><span class="pre">known</span> <span class="pre">issues</span></code>(http://www.ecoinvent.org/database/ecoinvent-version-3/ecoinvent-v30/known-data-issues/)
which have to be resolved or ignored by the importer.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Brightway2 cannot precisely reproduce the LCI and LCIA results given by
the ecoinvent centre. The technosphere matrix used by ecoinvent cannot
be reproduced from the provided unit process datasets. However, the
differences for most products are quite small.</p>
</div>
<p>We start by removing some exchanges from most datasets. Specifically, we
remove exchanges with amounts of zero, both coproducts and technosphere
or biosphere inputs (<code class="docutils literal notranslate"><span class="pre">remove_zero_amount_coproducts</span></code> and
<code class="docutils literal notranslate"><span class="pre">remove_zero_amount_inputs_with_no_activity</span></code>).</p>
<p>We then assign reference products. Although each unit process should
have a single output, coproducts which have been allcoated away are
often still included, with amounts of zero. We use two strategies to
choose the reference product:
<code class="docutils literal notranslate"><span class="pre">es2_assign_only_product_with_amount_as_reference_product</span></code> and
<code class="docutils literal notranslate"><span class="pre">assign_only_product_as_production</span></code>.</p>
<p>Next, a composite code is generated, using the UUID of the activity and
the product (<code class="docutils literal notranslate"><span class="pre">create_composite_code</span></code>).</p>
<p>Biosphere flow exchanges are now normalized
(<code class="docutils literal notranslate"><span class="pre">drop_unspecified_subcategories</span></code>) and linked
(<code class="docutils literal notranslate"><span class="pre">link_biosphere_by_flow_uuid</span></code>). Internal technosphere exchanges are
also linked, using the composite codes
(<code class="docutils literal notranslate"><span class="pre">link_internal_technosphere_by_composite_code</span></code>).</p>
<p>Not all technosphere exchanges are linked, however. We need to drop two
different types of exchanges, as we have no way of linking them. First,
there are some exchanges with listed products but no listed activities -
and no activity in the database produces these products. Removal is done
with the strategy <code class="docutils literal notranslate"><span class="pre">delete_exchanges_missing_activity</span></code>.</p>
<p>Additionally, there are some exchanges with listed products and
activities - but the given activity doesn’t produce the listed product.
These exchanges also have to be deleted, using the strategy
<code class="docutils literal notranslate"><span class="pre">delete_ghost_exchanges</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ecoinvent 3.1 includes some dummy biosphere flows (<code class="docutils literal notranslate"><span class="pre">Fluoranthene_temp</span></code>, <code class="docutils literal notranslate"><span class="pre">Chrysene_temp</span></code>, etc.). They can be safely deleted using using <code class="docutils literal notranslate"><span class="pre">.drop_unlinked(True)</span></code>.</p>
</div>
</section>
<section id="importing-from-simapro">
<h3>Importing from SimaPro<a class="headerlink" href="#importing-from-simapro" title="Link to this heading">#</a></h3>
<p>Importing SimaPro CSV files is also a bit of a headache. Pré, the makers
of SimaPro, have done a lot of work to make LCA software accessible and
understandable. This work includes making changes to process names and
other metadata, which makes linking these processes back to original
ecoinvent data difficult. Fortunately, Pré has been very helpful is
supplying correspondence files, which we can use to move (to the best of
our ability) from the “SimaPro world” to “ecoinvent world”.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Importing SimaPro XML export files is not recommended, as there are bugs with exporting ecoinvent 3 processes.</p>
</div>
</section>
<section id="importing-from-the-standard-excel-template">
<h3>Importing from the standard Excel template<a class="headerlink" href="#importing-from-the-standard-excel-template" title="Link to this heading">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can see these ideas in practive in <code class="docutils literal notranslate"><span class="pre">basic</span> <span class="pre">database</span></code>(https://github.com/brightway-lca/brightway2-io/blob/master/tests/fixtures/excel/basic_example.xlsx?raw=true)
and <code class="docutils literal notranslate"><span class="pre">parameterized</span> <span class="pre">database</span></code>(https://github.com/brightway-lca/brightway2-io/blob/master/tests/fixtures/excel/sample_activities_with_variables.xlsx?raw=true)
Excel templates.</p>
</div>
<p>You can define inventory datasets in many ways in Excel, but there is a
standard template which is supported by the <code class="docutils literal notranslate"><span class="pre">ExcelImporter</span></code>. The
template should be pretty self-explanatory, and follows this general
format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Project</span> <span class="n">parameters</span> <span class="p">(</span><span class="n">optional</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span>
<span class="o">&lt;</span><span class="n">value</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">value</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">value</span>

<span class="n">Database</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">name</span> <span class="n">of</span> <span class="n">database</span>
<span class="o">&lt;</span><span class="n">database</span> <span class="n">field</span> <span class="n">name</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">database</span> <span class="n">field</span> <span class="n">value</span>

<span class="n">Database</span> <span class="n">Parameters</span> <span class="p">(</span><span class="n">Optional</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span>
<span class="o">&lt;</span><span class="n">value</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">value</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">value</span>

<span class="n">Activity</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">name</span> <span class="n">of</span> <span class="n">activity</span>
<span class="o">&lt;</span><span class="n">database</span> <span class="n">field</span> <span class="n">name</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">database</span> <span class="n">field</span> <span class="n">value</span>
<span class="p">(</span><span class="n">Optional</span> <span class="n">blank</span> <span class="n">line</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="n">Parameters</span> <span class="p">(</span><span class="n">Optional</span><span class="p">),</span> <span class="o">&lt;</span><span class="n">name</span> <span class="n">of</span> <span class="n">parameter</span> <span class="n">group</span> <span class="p">(</span><span class="n">optional</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span>
<span class="o">&lt;</span><span class="n">value</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">value</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">value</span>
<span class="p">(</span><span class="n">Optional</span> <span class="n">blank</span> <span class="n">line</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="n">Exchanges</span>
<span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">column</span> <span class="n">label</span>
<span class="o">&lt;</span><span class="n">value</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">value</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">value</span>
<span class="o">&lt;</span><span class="n">value</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">value</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">value</span>
</pre></div>
</div>
<p>Data can be split over many worksheets. To mark a worksheet as one that
should be skipped by the importer, put the string “skip” in cell 1A.</p>
<p>Sections are split by the presence of blank lines. There are two kinds
of sections: data and metadata. Metadata sections are used for the
descriptions of databases (<code class="docutils literal notranslate"><span class="pre">Database</span></code>) and activities (<code class="docutils literal notranslate"><span class="pre">Activity</span></code>, until
<code class="docutils literal notranslate"><span class="pre">Exchanges</span></code>). In metadata sections, only the first two columns are
read - all other columns are ignored. In the data sections —
<code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">parameters</span></code>, <code class="docutils literal notranslate"><span class="pre">Parameters</span></code>, and <code class="docutils literal notranslate"><span class="pre">Exchanges</span></code> - all columns are
read, and should have column headings. You can limit the number of
columns read by inserting the string <code class="docutils literal notranslate"><span class="pre">cutoff</span></code> in cell 1A, and the column
index <strong>after which</strong> the importer should start ignoring columns in cell
1B. For example, if you put <code class="docutils literal notranslate"><span class="pre">4</span></code> in cell 1B, the first four columns would
be included, and the rest ignored.</p>
<p>Keep in mind the following general restrictions and notes:</p>
<ul class="simple">
<li><p>Provide useful codes! There is no reason to use e.g. UUIDs, unless
you are feeling masochistic. You can also skip providing codes at
all, they will be autogenerated.</p></li>
<li><p>As in the activity data format, there are no required fields, and
you can also insert your own.</p></li>
<li><p>Each workbook can only describe data for one <code class="docutils literal notranslate"><span class="pre">Database</span></code>. Multiple
<code class="docutils literal notranslate"><span class="pre">Database</span></code> sections will raise an error!</p></li>
<li><p>Input exchanges must be linked using the data provided in the
spreadsheet. That means that you may need to provide an activity
name and a reference product when trying to link against
ecoinvent.</p></li>
<li><p>Linking is done using the column headings exactly as provided. You
should check to make sure the capitalization, spelling, and
spacing are consistent with the attributes in the background
databases you want to link against.</p></li>
<li><p>Worksheet names don’t have any special meaning to the importer,
and are only used to indicate where errors occurred.</p></li>
</ul>
<p>Parameters are a bit different - as they are trickier to handle, their
sections are stricter:</p>
<ul class="simple">
<li><p>All parameter sections must have the column “name”. Names should
be unique within a parameter section.</p></li>
<li><p>Stochastic variables should have the usual uncertainty columns,
e.g. uncertainty type, loc, scale, minimum, maximum.</p></li>
<li><p>Variables which are defined by formulas should have the column</p></li>
<li><p>Parameters can have an “amount” column, but if there is also a
“formula” column, the amount will be overwritten on import as
the formula is evaluated.</p></li>
<li><p>Formulas should be for consumption by Python, not Excel; they will
be interpreted by <code class="docutils literal notranslate"><span class="pre">asteval</span></code>(https://newville.github.io/asteval/).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Database</span></code>, <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">parameters</span></code>, and <code class="docutils literal notranslate"><span class="pre">Database</span> <span class="pre">parameters</span></code>
don’t have to be in any order or in any particular worksheet.
There can be multiple <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">parameters</span></code> and
<code class="docutils literal notranslate"><span class="pre">Database</span> <span class="pre">parameters</span></code> sections, they will be concatenated.</p></li>
</ul>
<p>The following data transformations are applied by the <code class="docutils literal notranslate"><span class="pre">ExcelImporter</span></code>:</p>
<ul class="simple">
<li><p>Numbers are translated from text into actual numbers.</p></li>
<li><p>Tuples, separated in the cell by the <code class="docutils literal notranslate"><span class="pre">::</span></code> string, are
reconstructed, i.e. “this::example” would become
<code class="docutils literal notranslate"><span class="pre">(&quot;this&quot;,</span> <span class="pre">&quot;example&quot;)</span></code>.</p></li>
<li><p>The strings “True” and “False” (by themselves, not as part of
a larger string) are transformed to their respective boolean
values.</p></li>
<li><p>Fields with the value <code class="docutils literal notranslate"><span class="pre">(Unknown)</span></code> are omitted on a per-row basis.</p></li>
</ul>
</section>
<section id="importing-lcia-methods-from-the-standard-excel-template">
<h3>Importing LCIA methods from the standard Excel template<a class="headerlink" href="#importing-lcia-methods-from-the-standard-excel-template" title="Link to this heading">#</a></h3>
<p>Proper implementation of life cycle impact assessment methods requires a complete set of metadata. However, for simple LCIA methods, Brightway
has a simplified importer for Excel and CSV files: <code class="docutils literal notranslate"><span class="pre">bw2io.ExcelLCIAImporter</span></code> and <code class="docutils literal notranslate"><span class="pre">bw2io.CSVLCIAImporter</span></code>. These function the same as other importer (i.e. you extract data, apply strategies until you are satisfied with the matching, and write the modified data). There are example <a class="reference external" href="https://github.com/brightway-lca/brightway2-io/raw/legacy/tests/fixtures/excel/lcia.xlsx">Excel workbooks</a> and <a class="reference external" href="https://github.com/brightway-lca/brightway2-io/raw/legacy/tests/fixtures/csv/lcia.csv">CSV files</a>.</p>
<p>Please note the following:</p>
<ul class="simple">
<li><p>Excel workbooks should only have one worksheet.</p></li>
<li><p>Default matching to biosphere flows is based on ``name<code class="docutils literal notranslate"><span class="pre">and</span></code>categories`.</p></li>
</ul>
<p>The convention for<code class="docutils literal notranslate"><span class="pre">categories</span></code>is the same as for inventory datasets: subcategories should be separated with <code class="docutils literal notranslate"><span class="pre">::</span></code>, e.g.<code class="docutils literal notranslate"><span class="pre">natural</span> <span class="pre">resource::in</span> <span class="pre">ground</span></code>. You can also list the main category and subcategory in separate columns, and use a strategy function to combine them. * The call function to instantiate the LCIA importer objects requires<code class="docutils literal notranslate"><span class="pre">filepath</span></code>,<code class="docutils literal notranslate"><span class="pre">name</span></code>(method name as a tuple),<code class="docutils literal notranslate"><span class="pre">description</span></code>, and<code class="docutils literal notranslate"><span class="pre">unit</span></code>.  What to do with unmatched exchanges? If there are unlinked exchanges, you have several options. If you aren’t sure what to do yet, you can save a temporary copy (that can be loaded later) using <code class="docutils literal notranslate"><span class="pre">.write_unlinked(&quot;some</span> <span class="pre">name&quot;)</span></code>. Calling <code class="docutils literal notranslate"><span class="pre">.statistics()</span></code> will show what kind of exchanges aren’t linked, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">sp</span><span class="o">.</span><span class="n">statistics</span><span class="p">()</span>
<span class="mi">366</span> <span class="n">datasets</span>     <span class="mi">3991</span> <span class="n">exchanges</span>     <span class="mi">2639</span> <span class="n">unlinked</span> <span class="n">exchanges</span>
<span class="n">Type</span> <span class="n">biosphere</span><span class="p">:</span> <span class="mi">170</span> <span class="n">unique</span> <span class="n">unlinked</span> <span class="n">exchanges</span>
<span class="n">Type</span> <span class="n">technosphere</span><span class="p">:</span> <span class="mi">330</span> <span class="n">unique</span> <span class="n">unlinked</span> <span class="n">exchanges</span>
</pre></div>
</div>
<p>The options to examine or resolve the unlinked exchanges are:</p>
<ul class="simple">
<li><p>You can write a spreadsheet of the characterization factors, including their linking status, with <code class="docutils literal notranslate"><span class="pre">.write_excel(&quot;some</span> <span class="pre">name&quot;)</span></code>.</p></li>
<li><p>You can apply new linking strategies with <code class="docutils literal notranslate"><span class="pre">.apply_strategies(some_new_strategy)</span></code>. Note that this method requires a <em>list</em> of strategies.</p></li>
<li><p>You can match technosphere or biosphere exchanges to other background databases using <code class="docutils literal notranslate"><span class="pre">.match_database(&quot;another</span> <span class="pre">database&quot;)</span></code>.</p></li>
</ul>
<p>To resolve unlinked biosphere exchanges which simply don’t exist in your current biosphere database, you can:</p>
<ul class="simple">
<li><p>Add them to the biosphere database with <code class="docutils literal notranslate"><span class="pre">add_unlinked_flows_to_biosphere_database()</span></code></p></li>
<li><p>Create a new biosphere database with<code class="docutils literal notranslate"><span class="pre">create_new_biosphere(&quot;new</span> <span class="pre">biosphere</span> <span class="pre">name&quot;)</span></code></p></li>
<li><p>Add the biosphere flows to the database you are currently working on (LCI databases can include both process and biosphere flows) with `add_unlinked_biosphere_flows_to_current_database()</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These methods have several options, and you should understand what they do and read their documentation before choosing between them.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can’t write an LCI database with unlinked exchanges.</p>
</div>
</section>
<section id="migrations">
<h3>Migrations<a class="headerlink" href="#migrations" title="Link to this heading">#</a></h3>
<p>Sometimes the only way to correctly link activities or biosphere flows is by applying a list of name (or other field) transforms. For example,SimaPro will export a process named “`sulfonyl`urea-compound {RoW}| production | Alloc Rec, S”, which corresponds to the ecoinvent process “`sulfonyl`urea-compound production”, with reference product “`sulfonyl`urea-compound” and location “RoW”. In another example, in ecoinvent 2, emissions of water to air were measured in kilograms, and in ecoinvent 3, emissions of water to air are measured in cubic
meters. In this case, our migration would look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="err">`</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;categories&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="err">`</span><span class="p">,</span>
    <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="err">`</span>
        <span class="p">(</span>
            <span class="c1">## First element is input data in the order of `fields` above</span>
            <span class="p">(</span><span class="s1">&#39;Water&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;air&#39;</span><span class="p">,),</span> <span class="s1">&#39;biosphere&#39;</span><span class="p">,</span> <span class="s1">&#39;kilogram&#39;</span><span class="p">),</span>
            <span class="c1">## Second element is new values to substitute</span>
            <span class="p">{</span>
                <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;cubic meter&#39;</span><span class="p">,</span>
                <span class="s1">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">0.001</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="err">`</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We call the application of transform lists “migrations”, and they are applied with the <code class="docutils literal notranslate"><span class="pre">.migrate(migrations_name)</span></code> method.</p>
<p>If the numeric values in an exchange need to changed, the special key ‘multiplier’ is used, where new_amount = multiplier * old_amount. Uncertainty information and formulas are adjusted automatically, if possible (see <code class="docutils literal notranslate"><span class="pre">utils.rescale_exchange</span></code>).</p>
<p>A few additional notes:</p>
<ul class="simple">
<li><p>Migrations change the underlying data, but do not do any linking -
you will also have to apply linking strategies after a migration.</p></li>
<li><p>Migrations can specify any number of fields, but of course the
fields must be present in the importing database.</p></li>
<li><p>TODO: Migrations can be specified in an excel template. Template
files must be processed using <code class="docutils literal notranslate"><span class="pre">convert_migration_file</span></code>.</p></li>
<li><p>Subcategories are not expanded automatically, so a separate row in
the migrations file would be needed for e.g.
<code class="docutils literal notranslate"><span class="pre">water</span> <span class="pre">(air,</span> <span class="pre">non-urban</span> <span class="pre">air</span> <span class="pre">or</span> <span class="pre">from</span> <span class="pre">high</span> <span class="pre">stacks)</span></code>.</p></li>
</ul>
</section>
<section id="importing-an-lcia-method">
<h3>Importing an LCIA method<a class="headerlink" href="#importing-an-lcia-method" title="Link to this heading">#</a></h3>
<p>LCIA methods can be imported from ecospold 1 XML files
(<code class="docutils literal notranslate"><span class="pre">EcoinventLCIAImporter</span></code>) and SimaPro CSV files
(<code class="docutils literal notranslate"><span class="pre">SimaProLCIACSVImporter</span></code>).</p>
<p>When importing an LCIA method or set of LCIA methods, you should specify
the biosphere database to link against e.g.
<code class="docutils literal notranslate"><span class="pre">EcoinventLCIAImporter(&quot;some</span> <span class="pre">file</span> <span class="pre">path&quot;,</span> <span class="pre">&quot;some</span> <span class="pre">biosphere</span> <span class="pre">database</span> <span class="pre">name&quot;)</span></code>.
If no biosphere database name is provided, the default <code class="docutils literal notranslate"><span class="pre">biosphere3</span></code>
database is used.</p>
<p>Both importers will attempt to normalize biosphere flow names and
categories to the ecospold2 standard, using the strategies:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">normalize_simapro_lcia_biosphere_categories</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">normalize_simapro_biosphere_names</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">normalize_biosphere_names</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">normalize_biosphere_categories</span></code></p></li>
</ul>
<p>Next, the characterization factors are examined to see if they are only
given for root categories, e.g. <code class="docutils literal notranslate"><span class="pre">('air',)</span></code> and not
<code class="docutils literal notranslate"><span class="pre">('air',</span> <span class="pre">'urban</span> <span class="pre">air</span> <span class="pre">close</span> <span class="pre">to</span> <span class="pre">ground')</span></code>. If only root categories are
characterized, then we assume that the characterization factors also
apply to all subcategories, using the strategy <code class="docutils literal notranslate"><span class="pre">match_subcategories</span></code>.</p>
<p>Finally, linking to the given or default biosphere database is
attempted, using the strategy <code class="docutils literal notranslate"><span class="pre">link_iterable_by_fields</span></code> and the standard
fields: name, categories, unit, location. Note that biosphere flows do
not actually have a location.</p>
<p>You can now check the linking statistics. If all biosphere flows are
linked, write the LCIA methods with <code class="docutils literal notranslate"><span class="pre">.write_methods()</span></code>. Note that
attempting to write an existing method will raise a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> unless
you use <code class="docutils literal notranslate"><span class="pre">.write_methods(overwrite=True)</span></code>, and trying to write methods
which aren’t completely linked will also raise a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>.</p>
<p>If there are unlinked characterization factors, you have several
options. If you aren’t sure what to do yet, you can save a temporary
copy (that can be loaded later) using <code class="docutils literal notranslate"><span class="pre">.write_unlinked(&quot;some</span> <span class="pre">name&quot;)</span></code>.
The options to examine or resolve the unlinked characterization factors
are:</p>
<ul class="simple">
<li><p>You can write a spreadsheet of the characterization factors,
including their linking status, with <code class="docutils literal notranslate"><span class="pre">.write_excel(&quot;some</span> <span class="pre">name&quot;)</span></code>.</p></li>
<li><p>You can apply new linking strategies with
<code class="docutils literal notranslate"><span class="pre">.apply_strategies(</span></code>some_new_strategy<code class="docutils literal notranslate"><span class="pre">)</span></code>. Note that this method
requires a <em>list</em> of strategies.</p></li>
<li><p>TODO: You can write all biosphere flows to a new biosphere
database with <code class="docutils literal notranslate"><span class="pre">.create_new_biosphere(&quot;some</span> <span class="pre">name&quot;)</span></code>.</p></li>
<li><p>If you are satisfied that you don’t care about the unlinked
characterization factors, you can drop them with
<code class="docutils literal notranslate"><span class="pre">.drop_unlinked()</span></code>.</p></li>
<li><p>Alternatively, you can add the missing biosphere flows to the
biosphere database using <code class="docutils literal notranslate"><span class="pre">.add_missing_cfs()</span></code>.</p></li>
</ul>
</section>
<section id="custom-strategies">
<h3>Custom Strategies<a class="headerlink" href="#custom-strategies" title="Link to this heading">#</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">strategy</span></code> is just a Python callable (usually a function) that follows
a few simple conventions: it takes the input data as a single input
argument, and returns the modified data as the only returned value.
Inventory data is store in <code class="docutils literal notranslate"><span class="pre">{ImporterClass}.data</span></code>, and has the following
form:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">`</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;some name&quot;</span><span class="p">,</span>
        <span class="o">...</span><span class="p">,</span> <span class="c1">## other metadata in key: value form</span>
        <span class="s1">&#39;exchanges&#39;</span><span class="p">:</span> <span class="err">`</span>
            <span class="p">{</span>
              <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
              <span class="o">...</span><span class="p">,</span> <span class="c1">## other data in key: value form</span>
            <span class="p">}</span>
        <span class="err">`</span>
    <span class="p">}</span>
<span class="err">`</span>
</pre></div>
</div>
<p>Here is an example strategy (from
<code class="docutils literal notranslate"><span class="pre">bw2io.strategies.csv.py</span></code>(https://github.com/brightway-lca/brightway2-io/blob/master/bw2io/strategies/csv.py)):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">csv_add_missing_exchanges_section</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;exchanges&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
            <span class="n">ds</span><span class="err">`</span><span class="s2">&quot;exchanges&quot;</span><span class="err">`</span> <span class="o">=</span> <span class="err">``</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
<p>This is short function, and is not complicated - most strategies will do
more.</p>
<section id="data-format-for-lcia-methods">
<h4>Data format for LCIA methods<a class="headerlink" href="#data-format-for-lcia-methods" title="Link to this heading">#</a></h4>
<p>In order to allow for the re-use of strategies, the data format for LCIA
methods is the same as for inventory databases. <code class="docutils literal notranslate"><span class="pre">name</span></code> is the name (as a
tuple) of the impact category, and <code class="docutils literal notranslate"><span class="pre">exchanges</span></code> is the list of
characterization factors. It is a bit awkward, but makes other things
easier.</p>
</section>
<section id="adding-other-inputs-to-a-strategy">
<h4>Adding other inputs to a strategy<a class="headerlink" href="#adding-other-inputs-to-a-strategy" title="Link to this heading">#</a></h4>
<p>Strategy functions should only take one input, but sometimes you want to
add other input arguments. For example, imagine the following silly
strategy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_silly_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">ds</span><span class="err">`</span><span class="s1">&#39;name&#39;</span><span class="err">`</span> <span class="o">+=</span> <span class="n">string</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
<p>If you tried to use this, it would raise an error, as <code class="docutils literal notranslate"><span class="pre">string</span></code> wouldn’t
be defined. The right approach here is
<code class="docutils literal notranslate"><span class="pre">currying</span></code>(https://en.wikipedia.org/wiki/Currying), which allows you to
give the values of some input arguments in advance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">add_silly_string_fixed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">add_silly_string</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;something silly&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You would then apply the strategy <code class="docutils literal notranslate"><span class="pre">add_silly_string_fixed</span></code>.</p>
</section>
<section id="applying-custom-strategies">
<h4>Applying custom strategies<a class="headerlink" href="#applying-custom-strategies" title="Link to this heading">#</a></h4>
<p>You apply strategies using the
<code class="docutils literal notranslate"><span class="pre">{ImporterClass}.apply_strategy(name_of_callable)</span></code> method. You could
also append your custom strategy to <code class="docutils literal notranslate"><span class="pre">{ImporterClass}.strategies</span></code>, so it
is used when you call <code class="docutils literal notranslate"><span class="pre">{ImporterClass}.apply_strategies</span></code>.</p>
</section>
</section>
</section>
<section id="export">
<h2>Export<a class="headerlink" href="#export" title="Link to this heading">#</a></h2>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-from-ecospold-1">Importing from <code class="docutils literal notranslate"><span class="pre">ecospold</span> <span class="pre">1</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import">Import</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-from-ecospold-2">Importing from <code class="docutils literal notranslate"><span class="pre">ecospold</span> <span class="pre">2</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-from-simapro">Importing from SimaPro</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-from-the-standard-excel-template">Importing from the standard Excel template</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-lcia-methods-from-the-standard-excel-template">Importing LCIA methods from the standard Excel template</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#migrations">Migrations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-an-lcia-method">Importing an LCIA method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-strategies">Custom Strategies</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-format-for-lcia-methods">Data format for LCIA methods</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-other-inputs-to-a-strategy">Adding other inputs to a strategy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-custom-strategies">Applying custom strategies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#export">Export</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
<div id="searchbox"></div></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/brightway-lca/brightway-documentation/edit/main/source/content/theory/methods/io.md">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../../_sources/content/theory/methods/io.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
<div class="tocsection supportbutton">

    <a href=" latest/../../../../content/other/support.html">
      <i class="far fa-heart"></i> Support Brightway
    </a>
</div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024 International Society for Industrial Ecology.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p>🌿🐛 Found a bug? Something not working? Frustrated? <a href=" latest/../../../../content/contributing/bugs.html">Please report it!</a></p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>